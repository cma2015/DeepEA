<tool id="CMR_Genomic_Feature" name="Correlate CMR with Genomic Feature" version='18.09'>
  <description></description>
  <command><![CDATA[
	ln -sf '${gff}' '${gff}.gtf';
	#if $feature_type.genome_feature == "GCContent":
		ln -sf '${feature_type.genomeSequence}' '${feature_type.genomeSequence}.fasta';
		Rscript ${__tool_directory__}/CMR_Genomic_Feature.R ${CMR_gene} ${gff}.gtf ${feature_type.genomeSequence}.fasta $geneWindow $stepSize $ratio "$feature_type.genome_feature";
		cp ${__tool_directory__}/CMR_Genomic_Feature.html $CMR_genome_feature_html;
	#else:
		Rscript ${__tool_directory__}/CMR_Genomic_Feature.R ${CMR_gene} ${gff}.gtf "NA" $geneWindow $stepSize $ratio "$feature_type.genome_feature";
		cp ${__tool_directory__}/CMR_Genomic_Feature.html $CMR_genome_feature_html;
	#end if
	rm ${__tool_directory__}/CMR_Genomic_Feature.html;
  ]]></command>

  <inputs>
	<param name="CMR_gene" type="data" format="tsv,txt" multiple="false" label="CMR related gene ID"/>
	<param name="gff" type="data" format="gff,gtf,gff3" label="Genome annotation in GTF/GFF3 format"/>
	<param name="geneWindow" type="integer" value="100" label="The number of genes used for analysis" help=""/>
	<param name="stepSize" type="integer" value="10" label="Step size"/>
	<param name="ratio" type="integer" value="1" label="The ratio between CMR genes and non-CMR genes"/>
	<conditional name="feature_type">
		<param name="genome_feature" type="select" label="Genome feature type" display="radio">
			<option value="geneLength" type="select">Gene length analysis</option>
			<option value="exonLength">Exon length analysis</option>
			<option value="intronLength">Intron length analysis</option>
			<option value="exonNumber">Exon number analysis</option>
			<option value="GCContent">GC Content analysis</option>
		</param>
		<when value="GCContent">
			<param name="genomeSequence" type="data" format="fasta" label="Reference genome sequence"/>
		</when>
	</conditional>
  </inputs>

  <stdio>
	<exit_code range="1:"  level="fatal" description="Error Running combine collection to a file" />
  </stdio>
  <outputs>
	<data name="CMR_genome_feature_html" format="html" label= "CMR_genome_feature.html">
	</data>
  </outputs>
  <help>

.. class:: infomark

**What it does**

This functions is designed to correlate CMR-realted gene with different type of genomic features including: 

- **Gene length analysis**
- **Exon length analysis**
- **Intron length analysis**
- **Exon number analysis**
- **GC content analysis**

To be specific, we split the genome in a sliding window of 100 (default) adjacent genes with step size of 10 (default), and calculate the frequency of CMR genes in each window (default: 100 adjacent genes).

.. class:: infomark

**Inputs**

- CMR-realted gene list
- Genome annotation in GTF/GFF3 format

.. class:: infomark

**Parameters**

- The number of adjacent genes used for analysis
- Step size
- The ratio between CMR genes and non-CMR genes

.. class:: infomark

**Outputs**

- An HTML document recording the correlation and difference between CMR with selected genomic feature. The following are example outputs:
	1. `Correlate CMR with gene length`_
	2. `Correlate CMR with exon length`_
	3. `Correlate CMR with intron length`_
	4. `Correlate CMR with exon number`_
	5. `Correlate CMR with GC content`_

.. _`Correlate CMR with gene length`: http://cma2015.github.io/DeepEA/demo_output/CMR_genomic_features_for_gene_length.html
.. _`Correlate CMR with exon length`: http://cma2015.github.io/DeepEA/demo_output/CMR_genomic_features_for_exon_length.html
.. _`Correlate CMR with intron length`: http://cma2015.github.io/DeepEA/demo_output/CMR_genomic_features_for_intron_length.html
.. _`Correlate CMR with exon number`: http://cma2015.github.io/DeepEA/demo_output/CMR_genomic_features_for_exon_number.html
.. _`Correlate CMR with GC content`: http://cma2015.github.io/DeepEA/demo_output/CMR_genomic_features_for_GC_content.html


</help>
    <citations>
        <citation type="doi">10.1104/pp.19.00323</citation>
    </citations>
</tool>

