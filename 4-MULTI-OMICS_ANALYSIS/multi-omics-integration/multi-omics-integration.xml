<tool id="Multi-omics-integration" name="Integrating three signals" version='18.09'>
  <description></description>
  <command><![CDATA[
  #if $if_subgenome.subgenome == "no":
	#if $if_gsea.gene_sets == "no":
		Rscript ${__tool_directory__}/2020-06-02-multi-omics-integration.R -cmrDir $CMR_gene -method $method -ifSubgenome FALSE -ifGSEA FALSE;
		mv ${__tool_directory__}/multi-omics-integration.html ${MOA};
	#else:
		#import json
        #import os

        #set $geneList = list()
        #for $fileone in $if_gsea.gene_list:
            $geneList.append(str($fileone.geneID))
        #end for
        #set geneList=",".join(geneList)
		Rscript ${__tool_directory__}/2020-06-02-multi-omics-integration.R -cmrDir $CMR_gene -method $method -ifSubgenome FALSE  -ifGSEA TRUE -geneList $geneList -bgGene $if_gsea.bgGene -enrichMethod $if_gsea.method;
		mv ${__tool_directory__}/multi-omics-integration.html ${MOA};
	#end if
  #else
	#if $if_gsea.gene_sets == "no":
		Rscript ${__tool_directory__}/2020-06-02-multi-omics-integration.R -cmrDir $CMR_gene -method $method -ifSubgenome TRUE -subgenome $if_subgenome.subgenome_data -homoeologs  $if_subgenome.homoeologs -ifGSEA FALSE -CDS $if_subgenome.CDS;
		mv ${__tool_directory__}/multi-omics-integration.html ${MOA};
	#else:
		#import json
        #import os

        #set $geneList = list()
        #for $fileone in $if_gsea.gene_list:
            $geneList.append(str($fileone.geneID))
        #end for
        #set geneList=",".join(geneList)
		Rscript ${__tool_directory__}/2020-06-02-multi-omics-integration.R -cmrDir $CMR_gene -method $method -ifSubgenome TRUE -subgenome $if_subgenome.subgenome_data -homoeologs  $if_subgenome.homoeologs  -CDS $if_subgenome.CDS -ifGSEA TRUE -geneList $geneList -bgGene $if_gsea.bgGene -enrichMethod $if_gsea.method;
		mv ${__tool_directory__}/multi-omics-integration.html ${MOA};
	#end if
  #end if
  ]]></command>

  <inputs>
	<param name="CMR_gene" type="data" format="tsv,txt" multiple="false" label="Multi omics quantication data" help = "A tab seperated matrix with four columns: geneID, CMR level, omics 1 level and omics 2 level"/>
	<param name="method" type="select" label="Please select a normalization method" display="radio" multiple="false">
		<option value="ecdf" selected="true">Cumulative distribution</option>
		<option value="z-score">Z-score based normalization</option>
		<option value="minMax">Min-max based normalization</option>
	</param>
	<conditional name="if_subgenome">
		<param name="subgenome" type="select" label="Do you have subgenome information"  display="radio" multiple="false">
			<option value="yes" selected="true">I have subgenome information</option>
			<option value="no">I don't have subgenome information</option>
		</param>
		<when value="yes">
			<param name="subgenome_data" type="data" format="tsv,txt" multiple="false" label="Subgnome information" help = "A tab seperated matrix with four columns: geneID, subgnome, duplicated.status (e.g., singletons or duplicates)"/>
			<param name="homoeologs" type="data" format="tsv,txt" multiple="false" label="Duplicated gene pairs (homoeologs)" help = ""/>
			<param name="CDS" type="data" format="fasta" multiple="false" label="The coding sequences of homoeologs" help = ""/>
		</when>
	</conditional>
	<conditional name="if_gsea">
		<param name="gene_sets" type="select" label="Do you have functional gene sets to perform gene set enrichment analysis?"  display="radio">
			<option value="yes" selected="true">Yes</option>
			<option value="no">No</option>
		</param>
		<when value="yes">
			<repeat name="gene_list" title="gene list" min="1">
				<param name="geneID" type="data" format="tsv,txt" multiple="false" label="Input functional gene list" help=""/>
			</repeat>
			<param name="bgGene" type="data" format="tsv,txt" multiple="false" label="Background gene list" help=""/>
			<param name="method" type="select" label="Please select a method for enrichment analysis" display="radio" multiple="false">
				<option value="permutation">Permutation-based test</option>
				<option value="fisher" selected="true">Fisher-exact test</option>
				<option value="chisq">Chi-square test</option>
			</param>
		</when>
	</conditional>
  </inputs>

  <stdio>
	<exit_code range="1:"  level="fatal" description="Error Running combine collection to a file" />
  </stdio>
  <outputs>
	<data name="MOA" format="html" label= "Multi-omics-integration-analysis.html">
	</data>
  </outputs>
  <help>

.. class:: infomark

**What it does**

This function is designed to correlate CMRs with other Omics Signal.

.. class:: infomark

**Inputs**

- CMR related gene ID with additional omics data
- Genome annotation in GTF/GFF3 format

.. class:: infomark

**Outputs**

- An HTML document recording the correlation between CMR and other other Omics Signal


</help>
</tool>

