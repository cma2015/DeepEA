<tool id="feature_engineering" name="Feature Selection" version="18.09">
    <description></description>
    <command><![CDATA[
    #if $method.type == "remove_redundant":
        #if $method.plot == "yes":
            Rscript ${__tool_directory__}/02_featureSelection.R -posMat ${posMat} -cutoff $method.cutoff -negMat ${negMat} -outFeatures ${featureMatrix} -method "remove_redundant" -plot TRUE -outFigure ${figure};
            mv ${figure}.pdf ${figure};
        #else:
            Rscript ${__tool_directory__}/02_featureSelection.R -posMat ${posMat} -cutoff $method.cutoff -negMat ${negMat} -outFeatures ${featureMatrix} -method "remove_redundant" -plot FALSE;
        #end if
    #elif $method.type == "variable_importance":
        #if $method.plot == "yes":
            Rscript ${__tool_directory__}/02_featureSelection.R -posMat ${posMat} -negMat ${negMat} -method "variable_importance" -algorithm $method.ML_algorithm -plot "TRUE" -outFigure ${figure} -featureNum $method.dimension -outFeatures ${featureMatrix} -outImportance ${featureImportance};
        #else:
            Rscript ${__tool_directory__}/02_featureSelection.R -posMat ${posMat} -negMat ${negMat} -method "variable_importance" -algorithm $method.ML_algorithm -plot "FALSE" -featureNum $method.dimension -outFeatures ${featureMatrix} -outImportance ${featureImportance};
        #end if
    #elif $method.type == "RFE":
        Rscript ${__tool_directory__}/02_featureSelection.R -posMat ${posMat} -negMat ${negMat} -outFeatures ${featureMatrix} -method "RFE" -evaluate $method.method -featureNum $method.sizes;
    #elif $method.type == "lasso_regression":
        Rscript ${__tool_directory__}/02_featureSelection.R -posMat ${posMat} -negMat ${negMat} -method "lasso_regression" -parallel $method.parallel -standardize $method.standardize -measure $method.measure -outImportance ${featureImportance} -outFeatures ${featureMatrix};
    #elif $method.type == "genetic_algorithm":
        Rscript ${__tool_directory__}/02_featureSelection.R -posMat ${posMat} -negMat ${negMat} -method "genetic_algorithm" -evaluate $method.method -repeats $method.repeat -iters $method.iter -outFeatures ${featureMatrix};
    #elif $method.type == "simulated_annealing":
        Rscript ${__tool_directory__}/02_featureSelection.R -posMat ${posMat} -negMat ${negMat} -method "simulated_annealing" -evaluate $method.method -repeats $method.repeat -iters $method.improve -outFeatures ${featureMatrix};
    #else:
        Rscript ${__tool_directory__}/02_featureSelection.R -posMat ${posMat} -negMat ${negMat} -method "drop_loss" -ntree $method.ntree -outImportance ${featureImportance}-outFeatures ${featureMatrix};
    #end if
	
    ]]></command>

    <inputs>
	    <param name="posMat" type="data" format="txt" label="Feature matrix of positive samples."/>
        <param name="negMat" type="data" format="txt" label="Feature matrix of negative samples."/>
        <!-- <param name="dimension" type="integer" value="100" label="The number of selected features."/> -->
        <conditional name="method">
            <param name="type" type="select" multiple="false" label="Select a type of feature selection method" display="radio">
                <option value="remove_redundant">Remove redundant features</option>
                <option value="variable_importance">Variable importance from machine learning algorithms</option>
                <option value="RFE">Recursive feature elimination (automatic feature selection)</option>
                <option value="lasso_regression">Least Absolute Shrinkage and Selection Operator (LASSO) regression</option>
                <option value="genetic_algorithm">Genetic algorithm</option>
                <option value="simulated_annealing">Simulated annealing</option>
                <!-- <option value="Infor_value">Information value and weights of evidence</option> -->
                <option value="drop_loss">Feature selection based on dropout loss</option>
            </param>
            <when value="remove_redundant">
                <param name="cutoff" type="float" value="0.75" label="Pearson correlation coefficient threshold:"/>
                <param name="plot" type="select" label="Visualize the feature importance?" multiple="false" display="radio">
                    <option value="yes" selected="true">Yes</option>
                    <option value="no">No</option>
                </param>
            </when>
            
            <when value="variable_importance">
                <param name="plot" type="select" label="Visualize the feature importance?" multiple="false" display="radio">
                    <option value="yes" selected="true">Yes</option>
                    <option value="no">No</option>
                </param>
                <param name="dimension" type="integer" value="100" label="The number of selected features."/>
                <param name="ML_algorithm" type="select" label="Variable importance from machine learning algorithms" multiple="false" display="radio">
                    <option value="ada">ada</option>
                    <option value="AdaBag">AdaBag</option>
                    <option value="AdaBoost.M1">AdaBoost.M1</option>
                    <option value="adaboost">adaboost</option>
                    <option value="bagEarth">bagEarth</option>
                    <option value="bagEarthGCV">bagEarthGCV</option>
                    <option value="bagFDA">bagFDA</option>
                    <option value="bagFDAGCV">bagFDAGCV</option>
                    <option value="bartMachine">bartMachine</option>
                    <option value="blasso">blasso</option>
                    <option value="BstLm">BstLm</option>
                    <option value="bstSm">bstSm</option>
                    <option value="C5.0">C5.0</option>
                    <option value="C5.0Cost">C5.0Cost</option>
                    <option value="C5.0Rules">C5.0Rules</option>
                    <option value="C5.0Tree">C5.0Tree</option>
                    <option value="cforest">cforest</option>
                    <option value="chaid">chaid</option>
                    <option value="ctree">ctree</option>
                    <option value="ctree2">ctree2</option>
                    <option value="cubist">cubist</option>
                    <option value="deepboost">deepboost</option>
                    <option value="earth">earth</option>
                    <option value="enet">enet</option>
                    <option value="evtree">evtree</option>
                    <option value="extraTrees">extraTrees</option>
                    <option value="fda">fda</option>
                    <option value="gamboost">gamboost</option>
                    <option value="gbm_h2o">gbm_h2o</option>
                    <option value="gbm">gbm</option>
                    <option value="gcvEarth">gcvEarth</option>
                    <option value="glmnet_h2o">glmnet_h2o</option>
                    <option value="glmnet">glmnet</option>
                    <option value="glmStepAIC">glmStepAIC</option>
                    <option value="J48">J48</option>
                    <option value="JRip">JRip</option>
                    <option value="lars">lars</option>
                    <option value="lars2">lars2</option>
                    <option value="lasso">lasso</option>
                    <option value="LMT">LMT</option>
                    <option value="LogitBoost">LogitBoost</option>
                    <option value="M5">M5</option>
                    <option value="M5Rules">M5Rules</option>
                    <option value="msaenet">msaenet</option>
                    <option value="nodeHarvest">nodeHarvest</option>
                    <option value="OneR">OneR</option>
                    <option value="ordinalNet">ordinalNet</option>
                    <option value="ORFlog">ORFlog</option>
                    <option value="ORFpls">ORFpls</option>
                    <option value="ORFridge">ORFridge</option>
                    <option value="ORFsvm">ORFsvm</option>
                    <option value="pam">pam</option>
                    <option value="parRF">parRF</option>
                    <option value="PART">PART</option>
                    <option value="penalized">penalized</option>
                    <option value="PenalizedLDA">PenalizedLDA</option>
                    <option value="qrf">qrf</option>
                    <option value="ranger">ranger</option>
                    <option value="Rborist">Rborist</option>
                    <option value="relaxo">relaxo</option>
                    <option value="rf">rf</option>
                    <option value="rFerns">rFerns</option>
                    <option value="rfRules">rfRules</option>
                    <option value="rotationForest">rotationForest</option>
                    <option value="rotationForestCp">rotationForestCp</option>
                    <option value="rpart">rpart</option>
                    <option value="rpart1SE">rpart1SE</option>
                    <option value="rpart2">rpart2</option>
                    <option value="rpartCost">rpartCost</option>
                    <option value="rpartScore">rpartScore</option>
                    <option value="rqlasso">rqlasso</option>
                    <option value="rqnc">rqnc</option>
                    <option value="RRF">RRF</option>
                    <option value="RRFglobal">RRFglobal</option>
                    <option value="sdwd">sdwd</option>
                    <option value="smda">smda</option>
                    <option value="sparseLDA">sparseLDA</option>
                    <option value="spikeslab">spikeslab</option>
                    <option value="wsrf">wsrf</option>
                    <option value="xgbLinear">xgbLinear</option>
                    <option value="xgbTree">xgbTree</option>
                </param>
            </when>

            <when value="RFE">
                <param name="sizes" type="integer" value="10" label="The number of most important features the rfe should iterate"/>
                <param name="method" type="select" label="The external resampling method" display="radio">
                    <option value="repeatedCV" selected="true">repeatedCV</option>
                    <option value="boot">boot</option>
                    <option value="cv">cv</option>
                    <option value="LOOCV">LOOCV</option>
                </param>
            </when>
            
            <when value="lasso_regression">
                <param name="measure" type="select" label="Loss to use for cross-validation." display="radio">
                    <option value="mse" selected="true">mse ( deviance for logistic and poisson regression, and partial-likelihood for the Cox model.)</option>
                    <option value="deviance">deviance (uses squared-error for gaussian models)</option>
                    <option value="class">class (applies to binomial and multinomial logistic regression only, and gives misclassification error.)</option>
                    <option value="auc">auc (two-class logistic regression only, and gives area under the ROC curve)</option>
                    <option value="C">C(Harrel's concordance measure, only available for cox models.)</option>
                </param>
                <param name="parallel" type="select" label="Parallel computation?" multiple="false" display="radio">
                    <option value="yes">Yes</option>
                    <option value="no" selected="true">No</option>
                </param>
                <param name="standardize" type="select" label="Standardize?" multiple="false" display="radio">
                    <option value="yes" selected="true">Yes</option>
                    <option value="no">No</option>
                </param>
            </when>

            <when value="genetic_algorithm">
                <param name="method" type="select" label="The external resampling method" display="radio">
                    <option value="repeatedCV" selected="true">repeatedCV</option>
                    <option value="boot">boot</option>
                    <option value="cv">cv</option>
                    <option value="LOOCV">LOOCV</option>
                </param>
                <param name="iter" type="integer" value="100" label="The number of interations"/>
                <param name="repeat" type="integer" value="3" label="The number of repeats"/>
            </when>

            <when value="simulated_annealing">
                <param name="method" type="select" label="The external resampling method" display="radio">
                    <option value="repeatedCV" selected="true">repeatedCV</option>
                    <option value="boot">boot</option>
                    <option value="cv">cv</option>
                    <option value="LOOCV">LOOCV</option>
                </param>
                <param name="improve" type="integer" value="100" label="n iterations without improvement before a reset"/>
                <param name="repeat" type="integer" value="3" label="The number of repeats"/>
            </when>

            <when value="drop_loss">
                <param name="ntree" type="integer" value="100" label="The number of trees"/>
            </when>

	    </conditional>
        
    </inputs>

    <outputs>
        <data format="txt" name="featureMatrix" label="selected_feature_matrix.txt"/>
        <data format="pdf" name="figure" label="feature_visualization.pdf">
            <filter>method['type'] == "remove_redundant"</filter>
            <filter>method['type'] == "variable_importance"</filter>
        </data>
        <data format="txt" name="featureImportance" label="Feature_importance.txt">
            <filter>method['type'] == "variable_importance"</filter>
            <filter>method['type'] == "lasso_regression"</filter>
            <filter>method['type'] == "drop_loss"</filter>
        </data>
    </outputs>
    <help>
    .. class:: infomark

    **What it does**

    This function can be used to select informative features based on different algorithms, in current version of DeepEA, we included seven algorithms: 
   
    - Remove redundant features
    - Variable importance from machine learning algorithms
    - Recursive feautre slimination (automatic feature selection)
    - Least Absolute Shrinkage and Selection Operator (LASSO) regression
    - Genetic algorithm
    - Simulated annealing
    - Feature selection based on dropout loss

    .. class:: infomark

    **Inputs**

    - **Feature matrix of positive samples**
    - **feature matrix of negative samples**

    .. class:: infomark

    **Parameters**

    - For **Remove redundant features**
        - Visualize the feature importance
        - Pearson correlation coefficient threshold
    - For **Variable importance from machine learning algorithms**
        - Visualize the feature importance
        - The number of selected features
        - select a machine learning algorithm for variable importance estimation
    - For **Recursive feature elimination (automatic feature selection)**
        - The number of most important features the rfe should iterate
        - The external resampling method
    - For **Least Absolute Shrinkage and Selection Operator (LASSO) regression**
        - Loss to use for cross-validation
        - Parallel computation
        - Standardize the dataset
    - For **Genetic algorithm**
        - The external resampling method
        - The number of iterations
        - The number of repeats
    - For **Simulated annealing**
        - The external resampling method
        - The number of iterations without improvement before a reset
        - The number of repeats
    - For **Feature selection based on dropout loss**
        - The number of trees
    

    .. class:: infomark

    **Outputs**

    - The selected feature matrix
    - PDF forcument of mostly important features

    </help>
    <citations>
        <citation type="doi">10.18637/jss.v028.i05</citation>
    </citations>
</tool>
